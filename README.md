# Push-Server
Mock Android device with checkin and registering it in any application, after that we can listen this device for push-notifications. [GCM-REVERSE]

Создание Андройд-устройства и его регистрация в любом приложении, после этого можно прослушивать устройство на наличие пуш-уведомлений.

## Возможное применение
Может быть такое, что вам нужно будет автоматизировать какое-либо действие в приложении, связанное с пуш-уведомлениями.
Самый простой пример - создание виртуальной карты Тинькофф. При запросе на создание виртуальной карты требуется ввести код из СМС/Пуш-уведомления.
С помощью этой программы можно будет избавиться от ввода вручную... 

1. Делаем запрос на ожидание пуш-уведомления.
2. Дожидаемся сообщение.
3. Парсим оттуда код и отправляем запрос с ним.
4. Получаем виртуальную карту.

## Инструкция
Используется база данных mongodb и драйвер для нее motor.

1. Клонируем репозиторий и устанавливаем все зависимости.
2. Запускаем app.py
3. Для создания андройд-устройства под необходимое приложение нужно отправить по адресу POST-запрос "http://localhost:5000/createDevice":
```python
{
  "publicKey": "AIzaSyAOaoKaLhW98vLuaCuBqFh8qtLnh5c51z0", # Публичный ключ приложения
  "appName": "mcdonalds-70126",
  "appId": "1:654771087992:android:79237bff987a6465",
  "appGroup": "com.apegroup.mcdonaldrussia"
}
# Все эти данные можно узнать при анализе трафика на момент первого запуска приложения
```

4. Получим примерно такой ответ:
```python
{
    "androidId": "3887232111648592054",                # Используется в дальнейшем для прослушивания устройства.
    "securityToken": "7868892933757783250",            # Используется в дальнейшем для прослушивания устройства.
    "pushToken": "fYNtErlHZOVrPqGa3jEsze:APA91b...",   # Этот параметр вам необходимо будет в какой-то момент указать при взаимодействии с API приложения.
    "deviceId": "cf8cdf0b9e9e03890ba5a7cb9d2c2134",    # Возможно, пригодится вам при взаимодействии с приложением.
    "uuid": "e88dfd2f-310b-487b-999e-d5a9579b4fc3".    # Уникальный идентификатор устройства в базе данных.
}
```
5. На данном этапе устройство уже зарегистрировано и готово к прослушиванию уведомлений от приложения. Чтобы начать прослушивание, необходимо отправить по адресу "http://localhost:5000/getPushMessage" POST-запрос:
```python
{
    "uuid": "3b51490d-45cc-44ee-913d-96fcb8bd6120",    # Уникальный идентификатор устройства в базе данных.
    "application": "com.apegroup.mcdonaldrussia",      # appGroup приложения, уведомление от которого хотите ожидать.
    "timeout": 180                                     # Необязательный параметр, который по-умолчанию 180 сек.
}
```

6. Если пуш-уведомление пришло за указанный промежуток времени, то вы получите сообщение c уведомлением, иначе получите сообщение об ошибке.
